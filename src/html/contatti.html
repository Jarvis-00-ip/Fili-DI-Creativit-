<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Contatti - Fili Di Creatività</title>
  <meta name="description" content="Entra in contatto con Fili di Creatività: domande, ordini, collaborazioni.">
  <meta name="author" content="Pietro">
  <meta name="keywords" content="contatti, contattaci, Fili di Creatività, email, telefono">
  <meta name="language" content="IT">
  <meta name="robots" content="index, follow">

  <link rel="icon" type="image/x-icon" href="../../favicon.ico">
  <link rel="stylesheet" href="../css/contatti.css">
  <link rel="stylesheet" href="../css/common.css">
  <link rel="stylesheet" href="../css/style-base.css">

  <!-- Script Google reCAPTCHA -->
  <script src="https://www.google.com/recaptcha/api.js" async defer></script>

  <style>
    .attachments-preview{display:flex; gap:12px; flex-wrap:wrap; margin-top:8px;}
    .att-thumb{width:96px; height:96px; border-radius:8px; overflow:hidden; position:relative; box-shadow:0 6px 16px rgba(0,0,0,.08);}
    .att-thumb img{width:100%; height:100%; object-fit:cover; display:block;}
    .att-remove{position:absolute; top:6px; right:6px; background:rgba(0,0,0,.6); color:#fff; border:0; width:26px; height:26px; border-radius:999px; display:inline-flex; align-items:center; justify-content:center; cursor:pointer;}
    .hint{font-size:.95rem;color:#666;margin-top:6px;}
    .error{color:#b00020;margin-top:6px;}

    /* Forza il campo reCAPTCHA come required */
    #g-recaptcha-response {
      display: block !important;
      position: absolute;
      margin: -50px 0 0 0 !important;
      z-index: -999999;
      opacity: 0;
    }
  </style>
</head>
<body>
  <!-- Snipcart container (nascosto) -->
  <div hidden id="snipcart" data-api-key=""></div>

  <!-- Navbar -->
  <nav class="navbar"></nav>

  <!-- Hero SOLO immagine -->
  <section class="contatti-hero" style="background: url('../../assets/img/contattaci.jpg') no-repeat center/cover;"></section>

  <!-- Form di contatto -->
  <section class="contatti-main">
    <div class="container">
      <div class="contact-info">
        <h2>Scrivici</h2>
        <p>Ti risponderemo entro 24/48 ore.</p>
        <p><strong>Email:</strong> info@filidicreativita.com</p>
        <p><strong>Telefono:</strong> +39 123 456 789</p>
      </div>

      <div class="contact-form">
        <form id="contactForm" action="https://formspree.io/f/xvgbyypw" method="POST" enctype="multipart/form-data">
          <label for="name">Nome e Cognome</label>
          <input type="text" id="name" name="name" placeholder="Il tuo nome" required>

          <label for="email">Email</label>
          <input type="email" id="email" name="email" placeholder="La tua email" required>

          <label for="subject">Oggetto</label>
          <input type="text" id="subject" name="subject" placeholder="Motivo del contatto">

          <label for="contact-product">Prodotto</label>
          <input type="text" id="contact-product" name="product" readonly placeholder="Prodotto selezionato (se presente)">

          <input type="hidden" id="contact-product-img" name="product_img" value="">
          <input type="hidden" id="contact-product-price" name="product_price" value="">

          <label for="contact-message">Messaggio</label>
          <textarea id="contact-message" name="message" rows="6" placeholder="Scrivici il tuo messaggio" required></textarea>

          <!-- reCAPTCHA v2 Custom -->
          <div class="g-recaptcha" data-sitekey="6LekytorAAAAABUFkPG_vwdX4ZJMFvuKUJTBjJq7"></div>

          <button type="submit" class="btn">Invia Messaggio</button>
          <p id="form-status" class="form-status" aria-live="polite"></p>
        </form>
      </div>
    </div>
  </section>

  <!-- Footer -->
  <div id="footer-placeholder"></div>
  <script src="../js/common.js"></script>

  <script>
  (function () {
    const qs = new URLSearchParams(window.location.search);
    const product = qs.get('product') || '';
    const price = qs.get('price') || '';
    const img = qs.get('img') || '';
    const message = qs.get('message') || '';

    const prodField = document.getElementById('contact-product');
    const msgField = document.getElementById('contact-message');
    const preview = document.getElementById('contact-product-preview');
    const hiddenImg = document.getElementById('contact-product-img');
    const hiddenPrice = document.getElementById('contact-product-price');

    if (prodField && product) prodField.value = product + (price ? ` — ${price} €` : '');
    if (msgField && message) msgField.value = message;
    if (hiddenImg && img) hiddenImg.value = img;
    if (hiddenPrice && price) hiddenPrice.value = price;

    if (preview && img) {
      const safeSrc = String(img).replace(/"/g, '%22').trim();
      preview.innerHTML = `<img src="${safeSrc}" alt="${product}" style="max-width:140px;border-radius:8px;box-shadow:0 6px 18px rgba(0,0,0,.08)">`;
      preview.setAttribute('aria-hidden','false');
    }

    const form = document.getElementById('contactForm');
    const status = document.getElementById('form-status');

    form.addEventListener('submit', async (ev) => {
      ev.preventDefault();
      const formData = new FormData(form);

      try {
        status.textContent = 'Invio in corso…';
        status.style.color = '#333';

        const response = await fetch(form.action, {
          method: form.method,
          body: formData,
          headers: { 'Accept': 'application/json' }
        });

        if (response.ok) {
          status.textContent = "Grazie! Il tuo messaggio è stato inviato ✅";
          status.style.color = "green";
          form.reset();
          const previewElm = document.getElementById('contact-product-preview');
          if (previewElm) previewElm.innerHTML = '';
        } else {
          const text = await response.text().catch(() => '');
          status.textContent = "Errore nell'invio, riprova ❌";
          status.style.color = "red";
          console.error('Form submit error', response.status, text);
        }
      } catch (err) {
        console.error(err);
        status.textContent = "Errore di rete durante l'invio, riprova ❌";
        status.style.color = "red";
      }
    });

    if (form && (product || message)) {
      setTimeout(() => {
        try { form.scrollIntoView({ behavior: 'smooth', block: 'center' }); } catch(e){ }
      }, 250);
    }
  })();

  // Forza reCAPTCHA come campo obbligatorio
  window.onload = function() { 
    var el = document.getElementById('g-recaptcha-response'); 
    if (el) { 
      el.setAttribute('required', 'required'); 
    } 
  }
  </script>
</body>
</html>
